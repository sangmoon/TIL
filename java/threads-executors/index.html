<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="어디서 봤는지는 모르지만 일단 Java">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="Java">
<meta property="og:description" content="어디서 봤는지는 모르지만 일단 Java">
<meta property="og:type" content="article">
<meta property="og:url" content="https://sangmoon.github.io/TIL/java/threads-executors/"><meta property="article:section" content="Java">
<meta property="article:published_time" content="2021-10-23T00:00:00+00:00">
<meta property="article:modified_time" content="2021-10-23T00:00:00+00:00">
<title>Java | Sangmoon's TIL</title>
<link rel=manifest href=/TIL/manifest.json>
<link rel=icon href=/TIL/favicon.png type=image/x-icon>
<link rel=stylesheet href=/TIL/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css integrity="sha256-RhgbyTN1upMgJudTs3xA5v+LsWqe93DHi8xmPkV3sbo=" crossorigin=anonymous>
<script defer src=/TIL/flexsearch.min.js></script>
<script defer src=/TIL/en.search.min.58e317a58bdb983ff9fe64dbce44994883782a83ea5a5d5fbf080e12279c4e0f.js integrity="sha256-WOMXpYvbmD/5/mTbzkSZSIN4KoPqWl1fvwgOEiecTg8=" crossorigin=anonymous></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/TIL/><span>Sangmoon's TIL</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/TIL/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Java</strong>
<label for=toc-control>
<img src=/TIL/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#runnable>Runnable</a></li>
<li><a href=#shutdown-executor>Shutdown Executor</a></li>
<li><a href=#future-interface>Future interface</a></li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=thread-excecutor>
Thread Excecutor
<a class=anchor href=#thread-excecutor>#</a>
</h1>
<p>Executor는 thread 생성 및 관리를 해주는 클래스이다. thread 를 직접 생성 하고 제어 하는 데에서 나올 수 있는
복잡성을 줄여준다. <code>Executors</code> 라는 Factory class 를 활용하거나 또는 직접 생성해줄 수도 있다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>ExecutorService executor <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newFixedThreadPool</span><span style=color:#f92672>(</span>10<span style=color:#f92672>);</span> <span style=color:#75715e>// by Executors
</span><span style=color:#75715e></span>
ExecutorService executor <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ThreadPoolExecutor<span style=color:#f92672>(</span>1<span style=color:#f92672>,</span> 1<span style=color:#f92672>,</span> 0L<span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>,</span> 
                                <span style=color:#66d9ef>new</span> LinkedBlockingQueue<span style=color:#f92672>&lt;</span>Runnable<span style=color:#f92672>&gt;());</span> <span style=color:#75715e>// directly 
</span></code></pre></div><p>ExecutorService 는 interface 이다.</p>
<ul>
<li>newFixedThreadPool : 고정된 갯수의 thread를 유지하는 executor이다.</li>
<li>newSingleThreadExecutor : 1개의 thread만 유지하는 executor이다.</li>
<li>newCachedThreadPool : thread 를 적당한 시간 동안만 cache 하는 executor이다.</li>
<li>newScheduledThreadPool : 일정 기간이나, 주기적으로 작업하는 thread pool 을 생성한다.</li>
<li>newSingleThreadScheduledExecutor : thread가 1개인 scheduledThreadPool 이다.</li>
</ul>
<h2 id=runnable>
Runnable
<a class=anchor href=#runnable>#</a>
</h2>
<p>ExecutorService 에서 thread 들이 할 일을 queue에 넣는다. 이 일을 Runnable 또는 Callable interface 로 만들 수 있다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Runnable runnableTask <span style=color:#f92672>=</span> <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
        TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedExecption e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>};</span>

Callable<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> callableTask <span style=color:#f92672>=</span> <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
    TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Task&#39;s execution&#34;</span><span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>ExecutorService의 API를 살펴보면</p>
<ul>
<li>execute()</li>
<li>submit()</li>
<li>invokeAny()</li>
<li>invokeAll()</li>
</ul>
<p>등이 있다. <code>execute</code> 는 void 타입으로, task가 실행 중인지 끝났는지 확인 할 방법이 없다.
<code>submit</code> 은 Callable 이나 Runnable task 를 받아서 Future type을 return 한다. 이 Future을 통해 진행 상황을 알 수 있다.
<code>invokeAny</code> 와 <code>invokeAll</code> 의 경우 <code>Collection&lt;Callable></code> 를 input으로 받아서 any의 경우 아무거나 1개의 return 값을 return 해주고
all은 모든 callable의 future를 return 해준다.</p>
<h2 id=shutdown-executor>
Shutdown Executor
<a class=anchor href=#shutdown-executor>#</a>
</h2>
<p>Executorservice는 기본적으로 GC되지 않는다. 그래서 필요할 때는 명시적으로 destory 해야 한다.
<code>shutdown</code> 과 <code>shutdownNow</code> 가 있는데, 둘 다 바로 thread가 꺼짐을 보장하지는 않는다.
따라서 다음과 같은 방법을 추천한다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
<span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>awaitTermination</span><span style=color:#f92672>(</span>800<span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdownNow</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdownNow</span><span style=color:#f92672>();</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=future-interface>
Future interface
<a class=anchor href=#future-interface>#</a>
</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>
</code></pre></div></article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#runnable>Runnable</a></li>
<li><a href=#shutdown-executor>Shutdown Executor</a></li>
<li><a href=#future-interface>Future interface</a></li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>