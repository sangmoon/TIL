<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Sangmoon's TIL</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="Item 10: Obey the general contract when overriding equals equals를 구현하는 건 쉽지 않다. 가장 쉬운 방법은 override 하지 않는 것이다. 다음 조건 중 하나라도 만족하면 구현하지 않는 것이 좋다.
 Each instance of the class is inherently unique. Thread와 같은 객체는 값보다 엔티티 자체를 표현한다. Object에서 제공하는 equals로 충분하다 There is no need for he class to provide a logical equality test. Client가 해당 기능을 필요하지 않다고 생각한다면 굳이 구현할 필요가 없다.">
<meta name=generator content="Hugo 0.88.1">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=/TIL/ananke/css/main.min.css>
<meta property="og:title" content>
<meta property="og:description" content="Item 10: Obey the general contract when overriding equals equals를 구현하는 건 쉽지 않다. 가장 쉬운 방법은 override 하지 않는 것이다. 다음 조건 중 하나라도 만족하면 구현하지 않는 것이 좋다.
 Each instance of the class is inherently unique. Thread와 같은 객체는 값보다 엔티티 자체를 표현한다. Object에서 제공하는 equals로 충분하다 There is no need for he class to provide a logical equality test. Client가 해당 기능을 필요하지 않다고 생각한다면 굳이 구현할 필요가 없다.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://sangmoon.github.io/TIL/posts/effectivejava/methodscommontoallobjects/item10/"><meta property="article:section" content="posts">
<meta itemprop=name content>
<meta itemprop=description content="Item 10: Obey the general contract when overriding equals equals를 구현하는 건 쉽지 않다. 가장 쉬운 방법은 override 하지 않는 것이다. 다음 조건 중 하나라도 만족하면 구현하지 않는 것이 좋다.
 Each instance of the class is inherently unique. Thread와 같은 객체는 값보다 엔티티 자체를 표현한다. Object에서 제공하는 equals로 충분하다 There is no need for he class to provide a logical equality test. Client가 해당 기능을 필요하지 않다고 생각한다면 굳이 구현할 필요가 없다.">
<meta itemprop=wordCount content="859">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content>
<meta name=twitter:description content="Item 10: Obey the general contract when overriding equals equals를 구현하는 건 쉽지 않다. 가장 쉬운 방법은 override 하지 않는 것이다. 다음 조건 중 하나라도 만족하면 구현하지 않는 것이 좋다.
 Each instance of the class is inherently unique. Thread와 같은 객체는 값보다 엔티티 자체를 표현한다. Object에서 제공하는 equals로 충분하다 There is no need for he class to provide a logical equality test. Client가 해당 기능을 필요하지 않다고 생각한다면 굳이 구현할 필요가 없다.">
</head>
<body class="ma0 avenir bg-near-white">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/TIL/ class="f3 fw2 hover-white no-underline white-90 dib">
Sangmoon's TIL
</a>
<div class="flex-l items-center">
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
POSTS
</aside>
<div id=sharing class=mt3>
<a href="https://www.facebook.com/sharer.php?u=https://sangmoon.github.io/TIL/posts/effectivejava/methodscommontoallobjects/item10/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a href="https://twitter.com/share?url=https://sangmoon.github.io/TIL/posts/effectivejava/methodscommontoallobjects/item10/&text=" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://sangmoon.github.io/TIL/posts/effectivejava/methodscommontoallobjects/item10/&title=" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div>
<h1 class="f1 athelas mt3 mb1"></h1>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h2 id=item-10-obey-the-general-contract-when-overriding-equals>Item 10: Obey the general contract when overriding equals</h2>
<p><code>equals</code>를 구현하는 건 쉽지 않다. 가장 쉬운 방법은 override 하지 않는 것이다.
다음 조건 중 하나라도 만족하면 구현하지 않는 것이 좋다.</p>
<ol>
<li>Each instance of the class is inherently unique. <code>Thread</code>와 같은 객체는 값보다 엔티티 자체를 표현한다. Object에서 제공하는 equals로 충분하다</li>
<li>There is no need for he class to provide a <code>logical equality</code> test. Client가 해당 기능을 필요하지 않다고 생각한다면 굳이 구현할 필요가 없다.</li>
<li>A superclass has already overridden equals, and the superclass behavior is appropriate for this class. 예를 들어 Set은 AbstractSet, List 는 AbstractList, Map은 AbstractMap에서 미리 구현했다.</li>
<li>The class is private or package-private and your are certain that its equals method will never be invoked. 정말 위험을 감수하기 싫으면 다음과 같이 처리할 수도 있다.</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Object o<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> AssertionError<span style=color:#f92672>();</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>정말 equlas 를 override 하고 싶으면 일반 규칙을 준수해야 한다. 다음과 같다.</p>
<ul>
<li><code>Reflexive</code>: for any Non-null reference value x, x.equals(x) must return true</li>
<li><code>Symmetric</code>: for any non-null reference values x and y, x.equals(y) == y.equals(x)</li>
<li><code>Transitive</code>: for any non-null reference values x,y,z, if x.equals(y) == true and y.equals(z) == true then x.equals(z) must return true</li>
<li><code>Consistent</code>: equals가 여러번 불려도 x, y 가 변경되지 않았다면 항상 같은 값을 return 해야 한다.</li>
<li>x.equals(null) must return false</li>
</ul>
<p>&mldr; 갑자기 이산수학이.. 하나씩 살펴보자</p>
<ul>
<li><code>Reflexivity</code> 이건 객체는 자기 자신과 항상 같아야 함을 뜻한다. 이걸 위반하는게 더 힘든데, 이 어려운 걸 해낸다면 collection에서 자기 자신을 찾을 수 없을 것이다.</li>
<li><code>Symmetry</code> 는 두 객체의 equals 값이 항상 같아야 한다는 것이다. 다음과 같이 만들면 위반할 수 있다.</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// violate sysmmetry
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CaseInsensitiveString</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String s<span style=color:#f92672>;</span>

    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>CaseInsensitiveString</span><span style=color:#f92672>(</span>String s<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>s</span> <span style=color:#f92672>=</span> Objects<span style=color:#f92672>.</span><span style=color:#a6e22e>requireNonNull</span><span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Object o<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>o <span style=color:#66d9ef>instanceof</span> CaseInsensitiveString<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>return</span> s<span style=color:#f92672>.</span><span style=color:#a6e22e>equalsInnoreCase</span><span style=color:#f92672>(</span>
                <span style=color:#f92672>((</span>CaseInsensitiveString<span style=color:#f92672>)</span>o<span style=color:#f92672>).</span><span style=color:#a6e22e>s</span>
            <span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>
        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>o <span style=color:#66d9ef>instanceof</span> String<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>return</span> s<span style=color:#f92672>.</span><span style=color:#a6e22e>equalsIgnoreCase</span><span style=color:#f92672>(</span>String o<span style=color:#f92672>);</span> <span style=color:#75715e>// one-way interoperability!
</span><span style=color:#75715e></span>        <span style=color:#f92672>}</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>위의 경우 CaseInsensitiveString.equals(String s) 는 true 가 나올수 있지만 String.equals(CaseInsensitiveString cis) 는 항상 false가 나오게 된다.
이렇게 되면 이 객체의 행동을 예측할 수 없게 된다.
따라서 String과 통합하려는 시도는&mldr; 멍청하다고 할 수 있다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// 그냥 String 통합은 포기!
</span><span style=color:#75715e></span><span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Object o<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>return</span> o <span style=color:#66d9ef>instanceof</span> CaseInsensitiveString <span style=color:#f92672>&amp;&amp;</span> 
    s<span style=color:#f92672>.</span><span style=color:#a6e22e>equalsInnoreCase</span><span style=color:#f92672>(((</span>CaseInsensitiveString<span style=color:#f92672>)</span>o<span style=color:#f92672>).</span><span style=color:#a6e22e>s</span><span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><ul>
<li><code>Transitivity</code> 이건 a와 b가 같고 b와 c 가 같으면 a와 c 가 같아야 함을 말한다. 위반하는걸 상상하기 어려운데&mldr; subclass가 equals에 영항을 주는 추가 정보를 담는 경우를 생각해보자.</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Point</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> x<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> y<span style=color:#f92672>;</span>

    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Point</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> x<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> y<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> x<span style=color:#f92672>;</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> y<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Object o<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>if</span><span style=color:#f92672>(!(</span>o <span style=color:#66d9ef>instanceof</span> Point<span style=color:#f92672>))</span>
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
        Point p <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>Point<span style=color:#f92672>)</span>o<span style=color:#f92672>;</span>
        <span style=color:#66d9ef>return</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>x</span> <span style=color:#f92672>==</span> x <span style=color:#f92672>&amp;&amp;</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>y</span> <span style=color:#f92672>==</span> y<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ColorPoint</span> <span style=color:#66d9ef>extends</span> Point <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Color color<span style=color:#f92672>;</span>

    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ColorPoint</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> x<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> y<span style=color:#f92672>,</span> Color color<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>x<span style=color:#f92672>,</span> y<span style=color:#f92672>);</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>color</span> <span style=color:#f92672>=</span> color<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>이 상태로 두면 ColorPoint는 부모인 Point의 equals를 사용하게 된다. 당연히 color 정보는 무시되고, 이걸 의도하진 않았겠으니 override 해야 할 거다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// violates symmetry
</span><span style=color:#75715e></span><span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Object o<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>if</span><span style=color:#f92672>(!(</span>o <span style=color:#66d9ef>instanceof</span> ColorPoint<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>o<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>((</span>ColorPoint<span style=color:#f92672>)</span>o<span style=color:#f92672>).</span><span style=color:#a6e22e>color</span> <span style=color:#f92672>==</span> color<span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>문제는 Point와 ColorPoint를 비교할 때 생긴다. 전자는 color를 무시하고 비교하지만
후자는 항상 false가 나오기 때문이다. 따라서 symmetry 를 위반한다. 그래서 만약 다음과 같이 바꾼다면</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// violates transivity
</span><span style=color:#75715e></span><span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Object o<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>if</span><span style=color:#f92672>(!(</span>o <span style=color:#66d9ef>instanceof</span> Point<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
    
    <span style=color:#75715e>// o is norla Point
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span><span style=color:#f92672>(!(</span>o <span style=color:#66d9ef>instanceof</span> ColorPoint<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> o<span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#75715e>// o is ColorPoint
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>o<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>((</span>ColorPoint<span style=color:#f92672>)</span>o<span style=color:#f92672>).</span><span style=color:#a6e22e>color</span> <span style=color:#f92672>==</span> color<span style=color:#f92672>;</span>

<span style=color:#f92672>}</span>
</code></pre></div><p>이러면 sysmmetry는 해결되지만, transitivity에서 문제가 생긴다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// what if?
</span><span style=color:#75715e></span>ColorPoint p1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ColorPoint<span style=color:#f92672>(</span>1<span style=color:#f92672>,</span> 2<span style=color:#f92672>,</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>RED</span><span style=color:#f92672>);</span>
Point p2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Point<span style=color:#f92672>(</span>1<span style=color:#f92672>,</span> 2<span style=color:#f92672>);</span>
ColorPoint p3 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ColorPoint<span style=color:#f92672>(</span>1<span style=color:#f92672>,</span> 2<span style=color:#f92672>,</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>BLUE</span><span style=color:#f92672>);</span>

p1<span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>p2<span style=color:#f92672>)</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>
p2<span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>p3<span style=color:#f92672>)</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>
p1<span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>p3<span style=color:#f92672>)</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>
</code></pre></div><p>왜냐하면 Point는 color를 무시하기 때문에 이런 결과가 나온다. 또한 다른 subclass가 있다고 한다면 무한 recursion에 빠질 수 있다.</p>
<p><code>getClass</code>를 사용해서 해결할 수 있다는 사람들도 있다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Object o<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>o <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> o<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> getClass<span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
    Point p <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>Point<span style=color:#f92672>)</span> o<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>return</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>x</span> <span style=color:#f92672>==</span> x <span style=color:#f92672>&amp;&amp;</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>y</span> <span style=color:#f92672>==</span> y<span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>같은 클래스여야만 equals를 확인한다. 그럴듯해보이지만 결과는 그렇지 않다. 상속을 완전 무시하는 결과이다. 따라서 지양해야하는 방향이다.</p>
<p>그럼 해결책은 무엇일까? 이건 객체지향 언어의 근본적인 동일성 문제이다. equals를 깨지 않으면서 클래스를 상속받아 값을 추가할 방법은 없다.</p>
<p>상속을 통한 방법은 없지만, 좋은 방법이 있다, <code>Item 18: 상속보단 구성!</code>
ColorPoint가 Point를 상속하는 대신 필드를 갖게하고 view 메소드를 주는 것이다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ColorPoint</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Point point<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Color color<span style=color:#f92672>;</span>

    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ColorPoint</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> x<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> y<span style=color:#f92672>,</span> Color color<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        point <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Point<span style=color:#f92672>(</span>x<span style=color:#f92672>,</span> y<span style=color:#f92672>);</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>color</span> <span style=color:#f92672>=</span> Objects<span style=color:#f92672>.</span><span style=color:#a6e22e>requireNonNull</span><span style=color:#f92672>(</span>color<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> Point <span style=color:#a6e22e>asPoint</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> point<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Object o<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>if</span><span style=color:#f92672>(!(</span>o <span style=color:#66d9ef>instanceof</span> ColorPoint<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
        <span style=color:#f92672>}</span>
        ColorPoint cp <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ColorPoint<span style=color:#f92672>)</span>o<span style=color:#f92672>;</span>
        <span style=color:#66d9ef>return</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>point</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>point<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> cp<span style=color:#f92672>.</span><span style=color:#a6e22e>color</span><span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>color<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><ul>
<li><code>Non-nullity</code>: <code>instanceof</code> keyword 가 인자가 null로 들어오면 false를 return하기 때문에 굳이 null check를 별도로 할 필요는 없다.</li>
</ul>
<p>결론적으로 수준높은 equals를 짜기 위해 다음 과정이 필요하다.</p>
<ol>
<li>Use the == operator to check if the argument is a reference to this object. 최적화를 위한 것</li>
<li>Use the instanceof operator to check if the argument has the correct type. interface 가 있다면 interface를 이용해라(Collection)</li>
<li>Cast the argument to the correct type</li>
<li>For each <code>significant</code> field in the class, check if that field of the argument matches the corresponding field of this object</li>
</ol>
<ul class=pa0>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://sangmoon.github.io/TIL>
&copy; Sangmoon's TIL 2021
</a>
<div>
</div>
</div>
</footer>
</body>
</html>